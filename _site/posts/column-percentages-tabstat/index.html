<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Adding column percentages of sums to tabstat « alvaro carril blog</title>
  <meta name="description" content="Tabstat is a very useful command to produce tables of various summary statistics. It also works seamlessly with estout, so this tables can be easily exported.">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://acarril.github.io/posts/column-percentages-tabstat">
  <link rel="alternate" type="application/rss+xml" title="alvaro carril blog" href="http://acarril.github.io/feed.xml" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.css" />
  <script type="text/javascript" src='/js/Statax.js'></script>
  <!-- <script type="text/javascript" src='http://haghish.com/statax/Statax.js'></script> -->
  <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54241026-2', 'auto');
  ga('send', 'pageview');

</script>
</head>


  <body>

    <header class="header">
  <div class="wrapper">
    <a class="site-title" href="/">alvaro carril blog</a>
    <nav class="site-nav">
      
        
      
        
        <a class="page-link" href="/about/">about</a>
        
      
        
        <a class="page-link" href="/posts/categories">posts</a>
        
      
        
      
        
      
        
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Adding column percentages of sums to tabstat</h1>
    <p class="post-meta">Apr 11, 2016</p>
  </header>

  <article class="post-content">
    <p>Tabstat is a very useful command to produce tables of various summary statistics. It also works seamlessly with estout, so this tables can be easily exported.</p>

<p>Suppose we have a dataset with information of 10 different companies over the a range of years. You can load this (fake) dataset using</p>

<pre class="sh_stata">
. use http://www.stata-press.com/data/r14/grunfeld, clear
</pre>

<p>We want to produce a table that sums all investments made so far by each firm and then export it. We can easily achieve that combining tabstat with estttab, producing the following result:</p>

<pre class="sh_stata">
. estpost tabstat invest, by(company) stat(sum)
. esttab, cell(sum)
-------------------------
                      (1)
                      sum
-------------------------
1                 12160.4
2                  8209.5
3                  2045.8
4                 1722.47
5                 1236.05
6                 1108.22
7                  951.91
8                  857.83
9                  837.78
10                  61.69
Total            29191.65
-------------------------
N                     200
-------------------------
</pre>

<p>Now suppose we want column percentages of those sums. Unfortunately, tabstat doesn’t have an option for asking that statistic, but we can manually construct it and add it to our stored estimates using estadd:</p>

<pre class="sh_stata">
. eststo: estpost tabstat invest, by(company) stat(sum)

. matrix colupct = e(sum) // create matrix with sums
. scalar c = colsof(colupct) // create scalar with number of rows of matrix
. matrix colupct = 100*colupct/colupct[1,c] // transorm matrix values to percentages
. estadd matrix colupct = colupct // add matrix 'colupct' to stored estimates

. esttab, cell(sum colupct)
-------------------------
                      (1)

              sum/colupct
-------------------------
1                 12160.4
                 41.65712
2                  8209.5
                 28.12277
3                  2045.8
                 7.008168
4                 1722.47
                 5.900557
5                 1236.05
                 4.234259
6                 1108.22
                  3.79636
7                  951.91
                 3.260898
8                  857.83
                 2.938614
9                  837.78
                  2.86993
10                  61.69
                 .2113276
Total            29191.65
                      100
-------------------------
N                     200
-------------------------
</pre>

<p>Finally, it is probably nicer to present those percentages with only one decimal and inside parenthesis. We can do this by adding the necessary options to esttab:</p>

<pre class="sh_stata">
. eststo clear // clear previously stored estimates
. esttab, cell(sum colupct(fmt(1) par))
-------------------------
                      (1)

              sum/colupct
-------------------------
1                 12160.4
                   (41.7)
2                  8209.5
                   (28.1)
3                  2045.8
                    (7.0)
4                 1722.47
                    (5.9)
5                 1236.05
                    (4.2)
6                 1108.22
                    (3.8)
7                  951.91
                    (3.3)
8                  857.83
                    (2.9)
9                  837.78
                    (2.9)
10                  61.69
                    (0.2)
Total            29191.65
                  (100.0)
-------------------------
N                     200
-------------------------
</pre>

  </article>
  
  

<div class="post-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'acarril'; // required: replace example with your forum shortname
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</div>




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://avatars3.githubusercontent.com/u/9773292?v=3&s=460" alt="Alvaro Carril">
  <div class="col-box-title name">Alvaro Carril</div>
  <p>Economist / Research analyst at J-PAL</p>
  <p class="contact">
    
    <a href="https://github.com/acarril"><i class="fa fa-github fa-2x"></i></a>
    
    
    <a href="https://www.researchgate.net/profile/Alvaro_Carril"><i class="ai ai-researchgate-square ai-2x"></i></a>
    
    
    <a href="http://twitter.com/alvcarril"><i class="fa fa-twitter fa-2x"></i></a>
    
    
    <a href="mailto:acarril@fen.uchile.cl"><i class="fa fa-envelope fa-2x"></i></a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">Recent Posts</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/posts/batch-processes">Parallel processes in batch mode</a></li>
    
      <li><a class="post-link" href="/posts/batch-jobs">Batch Jobs</a></li>
    
      <li><a class="post-link" href="/posts/column-percentages-tabstat">Adding column percentages of sums to tabstat</a></li>
    
      <li><a class="post-link" href="/posts/prob-false-positives">On the probability of false positives</a></li>
    
      <li><a class="post-link" href="/posts/slutsky">Slutsky matrix times price vector</a></li>
    
  </ul>
</div>
<!--
<div class="col-box post-toc hide">
  <div class="col-box-title">TOC</div>
</div>
-->

        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2016 Alvaro Carril
</div>
</footer>

<script src="/js/easybook.js"></script>

  </body>

</html>
